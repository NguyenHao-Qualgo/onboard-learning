header:
  version: 14

repos:
  uav-qualgo:
    layers:
      layers/meta-edk2:
      layers/meta-skytrack-kernel:
      layers/meta-skytrack-secureboot:

  meta-rtlwifi:
    path: repos/meta-rtlwifi
    url: https://github.com/EmbeddedAndroid/meta-rtlwifi
    branch: master

local_conf_header:
  secure-boot: |
    SECUREBOOT_KEYS_DIR ?= "${TOPDIR}/../uefi_keys"
    SECUREBOOT_PK_KEY   = "${SECUREBOOT_KEYS_DIR}/PK.key"
    SECUREBOOT_PK_CERT  = "${SECUREBOOT_KEYS_DIR}/PK.crt"
    SECUREBOOT_KEK_KEY  = "${SECUREBOOT_KEYS_DIR}/KEK.key"
    SECUREBOOT_KEK_CERT = "${SECUREBOOT_KEYS_DIR}/KEK.crt"
    SECUREBOOT_DB_ESL   = "${SECUREBOOT_KEYS_DIR}/db.esl"
    SECUREBOOT_DB_AUTH  = "${SECUREBOOT_KEYS_DIR}/db.auth"

    UEFI1_DB_KEY   = "${SECUREBOOT_KEYS_DIR}/sign-uefi1.key"
    UEFI1_DB_CERT  = "${SECUREBOOT_KEYS_DIR}/sign-uefi1.crt"

    UEFI2_DB_KEY   = "${SECUREBOOT_KEYS_DIR}/sign-uefi2.key"
    UEFI2_DB_CERT  = "${SECUREBOOT_KEYS_DIR}/sign-uefi2.crt"

    KERNEL_DB_KEY  = "${SECUREBOOT_KEYS_DIR}/sign-kernel.key"
    KERNEL_DB_CERT = "${SECUREBOOT_KEYS_DIR}/sign-kernel.crt"

    IMAGE_INSTALL:append = " \
      grub-efi \
      secureboot-keys uefi1-prebuilt \
      nvme-cli coreutils \
      busybox mtd-utils \
      base-files base-passwd shadow \
      util-linux coreutils e2fsprogs \
      apt bash sudo less vim dpkg \
      net-tools iproute2 iputils \
      openssh-sftp-server dropbear \
      dosfstools openssh procps \
      parted findutils zstd grep sed gawk \
      linux-firmware \
      networkmanager networkmanager-nmcli iw wpa-supplicant wireless-regdb-static \
      kernel-module-ath9k-htc \
      kernel-module-rt2800usb \
      kernel-module-rtl8187 \
      kernel-module-iwlwifi \
      kernel-module-nvme \
      kernel-module-nvpps \
      rtl8812au \
    "

    IMAGE_INSTALL:append = " initrdscripts edk2-bootloader-firmware"
    IMAGE_INSTALL:append = " cuda-toolkit cuda-samples"

    KERNEL_MODULE_AUTOLOAD:append = " nvme nvme-core ucsi_ccg rt2800usb ath9k_htc 8812au "

    PACKAGE_CLASSES = "package_deb"
    EXTRA_IMAGE_FEATURES ?= "debug-tweaks"

    IMAGE_INSTALL:remove = " dropbear"